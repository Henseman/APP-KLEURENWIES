<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kleurenwies Scorebord</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            text-align: center;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        table, th, td {
            border: 1px solid black;
            padding: 10px;
        }
        .input-group {
            margin: 10px 0;
        }
    </style>
</head>
<body>

    <h1>Kleurenwies Scorebord</h1>

    <h2>Huidige Spelronde: <span id="ronde">{{ ronde }}</span></h2>
    <h2>Huidige Deler: <span id="deler">Speler {{ deler }}</span></h2>

    <table>
        <thead>
            <tr>
                <th>Speler</th>
                <th>Naam</th>
                <th>Score</th>
            </tr>
        </thead>
        <tbody>
            {% for key, naam in namen.items() %}
            <tr>
                <td>{{ key }}</td>
                <td>{{ naam }}</td>
                <td id="score_{{ key }}">{{ scores[key] }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <h2>Nieuw Spel Invoeren</h2>
    <div class="input-group">
        <label for="contract">Contract:</label>
        <select id="contract">
            <option value="Samen 8">Samen 8</option>
            <option value="Solo 5">Solo 5</option>
            <option value="Samen 9">Samen 9</option>
            <option value="Solo 6">Solo 6</option>
            <option value="Samen 10">Samen 10</option>
            <option value="Solo 7">Solo 7</option>
            <option value="Samen 11">Samen 11</option>
            <option value="Kleine Miserie">Kleine Miserie</option>
            <option value="Samen 12">Samen 12</option>
            <option value="Solo 8">Solo 8</option>
            <option value="Piccolo">Piccolo</option>
            <option value="Samen 13">Samen 13</option>
            <option value="Solo 9">Solo 9</option>
            <option value="Troel 8">Troel 8</option>
            <option value="Miserie">Miserie</option>
            <option value="Solo 10">Solo 10</option>
            <option value="Solo 11">Solo 11</option>
            <option value="Open Miserie">Open Miserie</option>
            <option value="Solo 12">Solo 12</option>
            <option value="Solo Slim 13">Solo Slim 13</option>
        </select>
    </div>

    <div class="input-group">
        <label for="zetter">Wie zet?</label>
        <select id="zetter">
            <option value="1">Speler 1</option>
            <option value="2">Speler 2</option>
            <option value="3">Speler 3</option>
            <option value="4">Speler 4</option>
        </select>
    </div>

    <div class="input-group">
        <label for="teamgenoten">Teamgenoten (indien van toepassing):</label>
        <input type="checkbox" name="teamgenoot" value="1"> Speler 1
        <input type="checkbox" name="teamgenoot" value="2"> Speler 2
        <input type="checkbox" name="teamgenoot" value="3"> Speler 3
        <input type="checkbox" name="teamgenoot" value="4"> Speler 4
    </div>

    <div class="input-group">
        <label for="slagen">Aantal slagen behaald:</label>
        <input type="number" id="slagen" min="0" max="13">
    </div>

    <button onclick="verwerkSpel()">Verwerk Spel</button>

    <h2>Historiek</h2>
    <ul id="historiek">
        {% for item in historiek %}
        <li>{{ item }}</li>
        {% endfor %}
    </ul>

    <button onclick="resetScores()">Reset Scores</button>

    <script>
        function verwerkSpel() {
            let contract = $("#contract").val();
            let zetter = $("#zetter").val();
            let slagen = $("#slagen").val();
            let teamgenoten = [];

            $("input[name='teamgenoot']:checked").each(function() {
                if ($(this).val() !== zetter) {
                    teamgenoten.push($(this).val());
                }
            });

            $.ajax({
                url: "/bereken",
                type: "POST",
                contentType: "application/json",
                data: JSON.stringify({
                    contract: contract,
                    zetter: zetter,
                    slagen: slagen,
                    teamgenoten: teamgenoten
                }),
                success: function(data) {
                    $("#ronde").text(data.ronde);
                    $("#deler").text("Speler " + data.deler);
                    
                    for (const [key, value] of Object.entries(data.scores)) {
                        $("#score_" + key).text(value);
                    }

                    $("#historiek").empty();
                    data.historiek.forEach(item => {
                        $("#historiek").append("<li>" + item + "</li>");
                    });

                    alert("Spel verwerkt!");
                },
                error: function(response) {
                    alert(response.responseJSON.error);
                }
            });
        }

        function resetScores() {
            $.ajax({
                url: "/reset",
                type: "POST",
                success: function() {
                    location.reload();
                }
            });
        }
    </script>

</body>
</html>
